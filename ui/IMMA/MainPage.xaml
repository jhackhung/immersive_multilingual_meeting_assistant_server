<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
             xmlns:idk="clr-namespace:Indiko.Maui.Controls.Markdown;assembly=Indiko.Maui.Controls.Markdown"
             x:Class="IMMA.MainPage"  
             Title="Immersive Multilingual Meeting Assistant"  
             BackgroundColor="#6A5ACD"  
             Shell.NavBarIsVisible="False">

    <ScrollView>
        <Grid RowDefinitions="Auto, Auto, Auto, Auto"  
              ColumnDefinitions="*,*"  
              Padding="10"  
              RowSpacing="20"  
              ColumnSpacing="20">

            <!-- 標頭 -->
            <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" StrokeShape="RoundRectangle 15" Padding="20" BackgroundColor="White" StrokeThickness="1" IsVisible="False">
                <VerticalStackLayout HorizontalOptions="Center" Spacing="15">
                    <Label Text="Immersive Multilingual Meeting Assistant" FontSize="24" FontAttributes="Bold" TextColor="#4a5568" HorizontalTextAlignment="Center" />
                    <HorizontalStackLayout Spacing="20" HorizontalOptions="Center">
                        <Border StrokeShape="RoundRectangle 20" Padding="10, 5" BackgroundColor="#e2e8f0">
                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                <BoxView Color="#10b981" WidthRequest="8" HeightRequest="8" CornerRadius="4" />
                                <Label Text="即時翻譯" FontSize="14" />
                            </HorizontalStackLayout>
                        </Border>
                        <Border StrokeShape="RoundRectangle 20" Padding="10, 5" BackgroundColor="#e2e8f0">
                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                <BoxView Color="#10b981" WidthRequest="8" HeightRequest="8" CornerRadius="4" />
                                <Label Text="語音辨識" FontSize="14" />
                            </HorizontalStackLayout>
                        </Border>
                        <Border StrokeShape="RoundRectangle 20" Padding="10, 5" BackgroundColor="#e2e8f0">
                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                <BoxView Color="#10b981" WidthRequest="8" HeightRequest="8" CornerRadius="4" />
                                <Label Text="數位分身" FontSize="14" />
                            </HorizontalStackLayout>
                        </Border>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- 雙向即時翻譯面板 -->
            <Border Grid.Row="1" Grid.Column="0" StrokeShape="RoundRectangle 15" Padding="25" BackgroundColor="White" StrokeThickness="1">
                <VerticalStackLayout Spacing="20">
                    <Label Text="🌐 雙向即時翻譯" FontSize="18" FontAttributes="Bold" TextColor="#2d3748" />

                    <HorizontalStackLayout Spacing="15">
                        <VerticalStackLayout Spacing="5" HorizontalOptions="FillAndExpand">
                            <Label Text="來源語言" />
                            <Picker x:Name="SourceLangPicker" SelectedIndex="0">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>中文</x:String>
                                        <x:String>English</x:String>
                                        <x:String>日文</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                        </VerticalStackLayout>
                        <VerticalStackLayout Spacing="5" HorizontalOptions="FillAndExpand">
                            <Label Text="目標語言" />
                            <Picker x:Name="TargetLangPicker" SelectedIndex="2">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>中文</x:String>
                                        <x:String>English</x:String>
                                        <x:String>日文</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <Border StrokeShape="RoundRectangle 12" Padding="15" BackgroundColor="#f8fafc" MinimumHeightRequest="150" StrokeThickness="1">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="🎤 原始語音" FontAttributes="Bold" />
                            <Editor x:Name="SourceTextEditor" Text="等待語音輸入..." HeightRequest="100" AutoSize="Disabled"/>
                            <Button x:Name="MicButton" Text="🎤 開始錄音" BackgroundColor="#ef4444" TextColor="White" CornerRadius="6" Clicked="OnTranslateRecording"/>
                        </VerticalStackLayout>
                    </Border>

                    <Border StrokeShape="RoundRectangle 12" Padding="15" BackgroundColor="#f8fafc" MinimumHeightRequest="150" StrokeThickness="1">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="🔄 翻譯結果" FontAttributes="Bold" />
                            <Editor x:Name="TranslatedTextEditor" Text="翻譯結果將顯示在這裡..." HeightRequest="100" AutoSize="Disabled"/>
                                                        <HorizontalStackLayout Spacing="10">
                                <Button x:Name="TranslateButton" Text="🔊 翻譯" BackgroundColor="#3b82f6" TextColor="White" CornerRadius="6" Clicked="OnTranslateClicked"/>
                                <Button x:Name="SpeakButton" Text="🔊 播放" BackgroundColor="#3b82f6" TextColor="White" CornerRadius="6" Clicked="OnPlayTranslateAudio"/>
                                <Button x:Name="LocalTtsButton" Text="🔊 本地播放" BackgroundColor="#10b981" TextColor="White" CornerRadius="6" Clicked="OnLocalTtsButtonClicked"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </Border>

            <!-- 會議記錄與分析面板 -->
            <Border Grid.Row="1" Grid.Column="1" StrokeShape="RoundRectangle 15" Padding="25" BackgroundColor="White" StrokeThickness="1">
                <VerticalStackLayout Spacing="20">
                    <Label Text="📝 會議記錄與分析" FontSize="18" FontAttributes="Bold" TextColor="#2d3748" />

                    <!-- TabView for transcript and summary -->
                    <Border StrokeShape="RoundRectangle 12" Padding="0" BackgroundColor="#f8fafc" StrokeThickness="1">
                        <Grid RowDefinitions="Auto, *">
                            <!-- Tab Headers -->
                            <Grid Grid.Row="0" ColumnDefinitions="*, *">
                                <Button x:Name="TranscriptTabButton" Grid.Column="0" Text="逐字稿"   
                                        BackgroundColor="#3b82f6" TextColor="White"   
                                        CornerRadius="0" Margin="0" HeightRequest="40"  
                                        Clicked="OnTranscriptTabClicked"/>
                                <Button x:Name="SummaryTabButton" Grid.Column="1" Text="重點整理"   
                                        BackgroundColor="#e2e8f0" TextColor="#4a5568"   
                                        CornerRadius="0" Margin="0" HeightRequest="40"  
                                        Clicked="OnSummaryTabClicked"/>
                            </Grid>

                            <!-- Tab Content -->
                            <Grid Grid.Row="1">
                                <!-- Transcript Tab -->
                                <ScrollView x:Name="TranscriptTab" HeightRequest="400"  IsVisible="true">
                                    <VerticalStackLayout x:Name="TranscriptArea">
                                    </VerticalStackLayout>
                                </ScrollView>

                                <!-- Summary Tab -->
                                <ScrollView x:Name="SummaryTab" HeightRequest="400" IsVisible="false">
                                    <VerticalStackLayout Padding="15">
                                        <idk:MarkdownView x:Name="SummaryMarkdown"
                                                         
                          H1FontSize="22"
                          H2FontSize="20"
                          H3FontSize="18"
                          CodeBlockFontFace="CamingoCodeRegular"
                          CodeBlockFontSize="12"
                          BlockQuoteFontFace="CamingoCodeItalic"
                          TextFontFace="OpenSans"
                          TextFontSize="14"
                          TableHeaderFontFace="OpenSans"
                          TableHeaderFontSize="14"
                          TableRowFontFace="OpenSans"
                          TableRowFontSize="12"
                          ImageAspect="Fill"
                          ParagraphSpacing="1.3">
                                        </idk:MarkdownView>
                                    </VerticalStackLayout>
                                </ScrollView>
                            </Grid>
                        </Grid>
                    </Border>
                    <HorizontalStackLayout Spacing="10" >
                        <Button x:Name="SpeakerRecognitionButton" Text="🎯 辨識講者" BackgroundColor="#8b5cf6" TextColor="White" CornerRadius="6" Clicked="OnSpeakerRecognitionClicked" />
                        <Button x:Name="GenerateSummaryButton" Text="📝 生成摘要" BackgroundColor="#8b5cf6" TextColor="White" CornerRadius="6" Clicked="OnSummaryButtonClicked"/>
                    </HorizontalStackLayout>
                    <!--<ScrollView HeightRequest="300">  
                        <VerticalStackLayout x:Name="TranscriptHistory">  
                            -->
                    <!-- Previous transcript history can be moved here if needed -->
                    <!--  
                        </VerticalStackLayout>  
                    </ScrollView>-->
                </VerticalStackLayout>
            </Border>

            <!-- 控制項 -->
            <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" StrokeShape="RoundRectangle 15" Padding="20" BackgroundColor="White" StrokeThickness="1">
                <FlexLayout JustifyContent="SpaceBetween" AlignItems="Center" Wrap="Wrap">

                    <HorizontalStackLayout Spacing="15" VerticalOptions="Center">
                        <VerticalStackLayout Spacing="5" WidthRequest="120">
                            <ImageButton x:Name="AvatarImageButton" 
                                        Source="avatar_placeholder.png" 
                                        WidthRequest="120" 
                                        HeightRequest="90" 
                                        Aspect="AspectFill"
                                         Margin="5"
                                        CornerRadius="8"
                                        BackgroundColor="Transparent"
                                        Clicked="OnAvatarImageButtonClicked" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Spacing="8">
                            <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                                <Label Text="🤖 自動回覆：" VerticalOptions="Center"/>
                                <Switch x:Name="AutoReplySwitch" />
                            </HorizontalStackLayout>
                            <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                                <Label Text="📹 Wav2Lip：" VerticalOptions="Center"/>
                                <Switch x:Name="Wav2LipSwitch" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Button x:Name="StartButton" Text="🚀 開始會議" BackgroundColor="#3b82f6" TextColor="White" CornerRadius="8" Clicked="OnStartButtonClicked"/>
                        <!--<Button Text="⏸️ 暫停" BackgroundColor="#10b981" TextColor="White" CornerRadius="8" />-->
                        <Button x:Name="StopButton" IsEnabled="False"  Text="⏹️ 結束會議" BackgroundColor="#e2e8f0" TextColor="#4a5568" CornerRadius="8" Clicked="OnStopButtonClicked" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Button Text="📤 匯出會議記錄" BackgroundColor="#3b82f6" TextColor="White" CornerRadius="8" Clicked="OnExportMeetingClicked"/>
                        <Button Text="📥 載入會議記錄" BackgroundColor="#3b82f6" TextColor="White" CornerRadius="8" Clicked="OnImportMeetingClicked" />
                    </HorizontalStackLayout>

                </FlexLayout>
            </Border>

        </Grid>
    </ScrollView>
</ContentPage>
